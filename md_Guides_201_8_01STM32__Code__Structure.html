<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>STM Code Blocks: The STM32 Code Structure</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">STM Code Blocks
   </div>
   <div id="projectbrief">Easy to use and understand code blocks for the STM MCU family</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_Guides_201_8_01STM32__Code__Structure.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">The STM32 Code Structure</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md1"></a> </p>
<h1><a class="anchor" id="autotoc_md2"></a>
A. General info</h1>
<p>A project created with STM32Cube MX is composed of the next files:</p><ul>
<li>ProjectName.ioc . This file contains the device (MCU/Development Board) settings (pin mapping/custom labeling, clock settings for different blocks), settings for ADC, Timers, DMA etc). When opened, this file triggers a graphicall windows where user can update device settings. After saving those settings, they are automatically included/updated into proper regions of the ProjectName/Core/src/main.c file</li>
<li>a collection of "header ".h" files" that contains lists of variable and functions of different software modules (files containing code for a specific functionality). This folder is ProjectName/Core/Inc.</li>
<li>a collection of "source ".c" files" that contains lists of variable and functions of different software modules, together with their values and associated code. This folder is ProjectName/Core.Src.</li>
</ul>
<p>A header file mult always be paired with a source file having the same name. The diference between them is that:</p><ul>
<li>a header file contains only a list of variables and functions. It has the same purpose as a Table of Contents.</li>
<li>a source file contains also the values of the variables and the code of the functions mentioned in the header file with the same name. It has the same purpose as a the content of a book chapter. To link the content of the source file with the content of the header file, the header file must be included into the source file with the line <code>#include &lt;headerFileName.h&gt;</code></li>
</ul>
<blockquote class="doxtable">
<p>&zwj;ℹ️ <b>Important</b>: To avoid defining a header file multiple types (and get compilation errors), a good practice is to always use "header guards" in header files. </p>
</blockquote>
<p>This means inside a header file you need to put your custom code as in the example bellow:</p>
<p>Examples of a .h file that uses header guards: </p><div class="fragment"><div class="line"><span class="comment">/* === Your_Heade_Name.h === */</span></div>
<div class="line"><span class="preprocessor">#ifndef INC_YOUR_HEADER_NAME_H_</span></div>
<div class="line"><span class="preprocessor">#define INC_YOUR_HEADER_NAME_H_</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">//Put here your custom code</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* INC_YOUR_HEADER_NAME_H_ */</span><span class="preprocessor"></span></div>
</div><!-- fragment --><p>Write your own code ONLY inside sections marked with comments like <code>/* USER CODE BEGIN x */</code> and <code>/* USER CODE END x */</code>. These regions are preserved when you regenerate code with STM32CubeMX. Anything outside these blocks may be deleted or overwritten.</p>
<p>As mentioned before, in STM32CubeIDE the device configuration (pin mapping, peripheral and clock settings etc.) are done graphically and included/updated into proper regions of the ProjectName/Core/src/main.c file. As for the rest of the code, it is highly recommended to split it in modules designed for specific functionalities (e.g. analog sensing, background tasks, import/export to non-volatile memory etc.). Subsequently, these modules are to be linked together into ProjectName/Core/src/main.c file. into the region shown in the next chapter.</p>
<h1><a class="anchor" id="autotoc_md3"></a>
B. The STM32 equivalent of setup() and loop() functions found in Arduine IDE</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Arduino   </th><th class="markdownTableHeadNone">STM32 (CubeMX/HAL)   </th><th class="markdownTableHeadNone">Notes    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>setup()</code>   </td><td class="markdownTableBodyNone">Code between <code>/* USER CODE BEGIN 2 */</code> and <code>/* USER CODE END 2 */</code> comments inside <code><a class="el" href="main_8c.html" title=": Main program body">main.c</a></code> file   </td><td class="markdownTableBodyNone">Initialization code goes here    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>loop()</code>   </td><td class="markdownTableBodyNone">Code between <code>/* USER CODE BEGIN 3 */</code> and <code>/* USER CODE END 2 */</code> comments inside <code><a class="el" href="main_8c.html" title=": Main program body">main.c</a></code> file   </td><td class="markdownTableBodyNone">Put your repetitive code here   </td></tr>
</table>
<p>Example in <code><a class="el" href="main_8c.html" title=": Main program body">main.c</a></code>: </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="main_8c.html#a840291bc02cba5474a4cb46a9b9566fe">main</a>(<span class="keywordtype">void</span>)</div>
<div class="line">{  <span class="comment">/* USER CODE BEGIN 2 */</span>     <span class="comment">// ← Initialization code here (like Arduino&#39;s setup())</span></div>
<div class="line">   <span class="comment">/* USER CODE END 2 */</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">while</span> (1)</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">/* USER CODE BEGIN 3 */</span>   <span class="comment">// ← Repeating code here (like Arduino&#39;s loop())</span></div>
<div class="line">    <span class="comment">/* USER CODE END 3 */</span></div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="ttc" id="amain_8c_html_a840291bc02cba5474a4cb46a9b9566fe"><div class="ttname"><a href="main_8c.html#a840291bc02cba5474a4cb46a9b9566fe">main</a></div><div class="ttdeci">int main(void)</div><div class="ttdoc">The application entry point.</div><div class="ttdef"><b>Definition</b> <a href="main_8c_source.html#l00077">main.c:77</a></div></div>
</div><!-- fragment --> <blockquote class="doxtable">
<p>&zwj;ℹ️ <b>Important</b>: Write your own code ONLY inside sections marked with comments like <code>/* USER CODE BEGIN x */</code> and <code>/* USER CODE END x */</code>. </p>
</blockquote>
<p>These regions are preserved when you regenerate code with STM32CubeMX. Anything outside these blocks may be deleted or overwritten.</p>
<h1><a class="anchor" id="autotoc_md4"></a>
C. Global Variables - Declaration, definition and inclusion in the main source code</h1>
<p>The most basic building block of a software is the variable. While the local variables can be simply defined directly into the software module where they are used (as we'll see in the next chapter), the global variables are recomented to be defined into a separate software module.</p>
<h2><a class="anchor" id="autotoc_md5"></a>
Global variables should be declared in a &lt;tt&gt;globals.h&lt;/tt&gt; file following these steps:</h2>
<ul>
<li>navigate to "Project Explorer / YourProject / Core / Inc";</li>
<li>right-click on "Inc" folder;</li>
<li>choose "New / Header file";</li>
<li>in the "New Header File" dialog window write "globals.h" in the "Header file:" field and choose "Default C header template" in "Template" field. Click "Finish".</li>
<li><code>globals.h</code> file opens automatically with some predefined code in it. Place your global variables just before the <code>endif /* GLOBALS_H_ */</code> line.</li>
<li>include also the stdbool.h and stdint.h libraries (to make the code able to use boolean and int type variables).</li>
</ul>
<blockquote class="doxtable">
<p>&zwj;Examples of supported variables: <code>int</code>, <code>char</code>, <code>float</code>, <code>bool</code>, <code>uint8_t</code>, <code>int16_t</code> </p>
</blockquote>
<p>Example of how the content of <code>globals.h</code> content should look like: </p><div class="fragment"><div class="line"><span class="comment">/* === globals.h === */</span></div>
<div class="line"><span class="preprocessor">#ifndef GLOBALS_H_</span></div>
<div class="line"><span class="preprocessor">#define GLOBALS_H_</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdbool.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdint.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">//START of declaring your variables</span></div>
<div class="line"><span class="keyword">extern</span> <span class="keywordtype">int</span> globalVariableName1;  <span class="comment">// Declaration of a 1st variable</span></div>
<div class="line"><span class="keyword">extern</span> <span class="keywordtype">int</span> globalVariableName2;  <span class="comment">// Declaration of a 2nd variable</span></div>
<div class="line"><span class="keyword">extern</span> <span class="keywordtype">int</span> globalVariableName3;  <span class="comment">// Declaration of a 3rd variable</span></div>
<div class="line"><span class="comment">//END of declaring your variables</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* GLOBALS_H_ */</span><span class="preprocessor"></span></div>
</div><!-- fragment --> <h2><a class="anchor" id="autotoc_md6"></a>
The global variables you declared in &lt;tt&gt;globals.h&lt;/tt&gt; must be also defined (assigned default values) into a &lt;tt&gt;globals.c&lt;/tt&gt; file following these steps:</h2>
<ul>
<li>navigate to "Project Explorer / YourProject / Core / Src";</li>
<li>right-click on "Src" folder;</li>
<li>choose "New / Source file";</li>
<li>in the "New Source File" dialog window write "globals.c" in the "Source file:" field and choose "Default C header template" in "Template" field. Click "Finish".</li>
<li><code>globals.c</code> file opens automatically. Add the '#include "global_variables.h"' line and set the type and the default value of each of your global variables.</li>
</ul>
<p>Example of how the content of <code>globals.c</code> content should look like: </p><div class="fragment"><div class="line"><span class="comment">/* === globals.c === */</span></div>
<div class="line"><span class="preprocessor">#include &quot;global_variables.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">//START of declaring your variables</span></div>
<div class="line"><span class="keywordtype">int</span> globalVariableName1 = 0;  <span class="comment">// Definition of the 1st variable</span></div>
<div class="line"><span class="keywordtype">int</span> globalVariableName2 = 0;  <span class="comment">// Definition of the 2nd variable</span></div>
<div class="line"><span class="keywordtype">int</span> globalVariableName3 = 0;  <span class="comment">// Definition of the 3rd variable</span></div>
<div class="line"><span class="comment">//START of declaring your variables</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md7"></a>
To make your global variables available to the main code, the &lt;tt&gt;globals.h&lt;/tt&gt; file must be included into &lt;tt&gt;main.c&lt;/tt&gt; file following these steps:</h2>
<ul>
<li>navigate to "Project Explorer / YourProject / Core / Src" and open the <code><a class="el" href="main_8c.html" title=": Main program body">main.c</a></code> file;</li>
<li>search for the &lsquo;'Private includes&rsquo;<code>section and include your</code>globals.h` file as shown in the example below. <div class="fragment"><div class="line"><span class="comment">/* === main.c === */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Private includes ----------------------------------------------------------*/</span></div>
<div class="line"><span class="comment">/* USER CODE BEGIN Includes */</span></div>
<div class="line"><span class="preprocessor">#include &quot;globals.h&quot;</span></div>
<div class="line"><span class="comment">/* USER CODE END Includes */</span></div>
</div><!-- fragment --></li>
</ul>
<h1><a class="anchor" id="autotoc_md8"></a>
D. Creating software module and its local variables</h1>
<p>From a pure technical point of view it's perfectly fine to have all the user code place in a single file (<a class="el" href="main_8c.html" title=": Main program body">main.c</a>). However, to make the use code more manageable it is more practical to organize it into multiple files (modules), each of them containing functions and local variables aimed for a single main functionality (e.g. "LCD_diplay_I2C" module, "Import_Export_NVRAM" module, "Background_Task_Scheduler" module. etc).</p>
<h2><a class="anchor" id="autotoc_md9"></a>
Workflow:</h2>
<ul>
<li>navigate to "Project Explorer / YourProject / Core / Inc";</li>
<li>right-click on "Inc" folder;</li>
<li>choose "New / Header file";</li>
<li>in the "New Header File" dialog window write "globals.h" in the "Header file:" field and choose "Default C header template" in "Template" field. Click "Finish".</li>
<li><code>globals.h</code> file opens automatically with some predefined code in it. Place your global variables just before the <code>endif /* GLOBALS_H_ */</code> line.</li>
<li>include also the stdbool.h and stdint.h libraries (to make the code able to use boolean and int type variables).</li>
</ul>
<blockquote class="doxtable">
<p>&zwj;Examples of supported variables: <code>int</code>, <code>char</code>, <code>float</code>, <code>bool</code>, <code>uint8_t</code>, <code>int16_t</code> </p>
</blockquote>
<p>Example of how the content of <code>globals.h</code> content should look like: </p><div class="fragment"><div class="line"><span class="comment">/* === globals.h === */</span></div>
<div class="line"><span class="preprocessor">#ifndef GLOBALS_H_</span></div>
<div class="line"><span class="preprocessor">#define GLOBALS_H_</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdbool.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdint.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">//START of declaring your variables</span></div>
<div class="line"><span class="keyword">extern</span> <span class="keywordtype">int</span> globalVariableName1;  <span class="comment">// Declaration of a 1st variable</span></div>
<div class="line"><span class="keyword">extern</span> <span class="keywordtype">int</span> globalVariableName2;  <span class="comment">// Declaration of a 2nd variable</span></div>
<div class="line"><span class="keyword">extern</span> <span class="keywordtype">int</span> globalVariableName3;  <span class="comment">// Declaration of a 3rd variable</span></div>
<div class="line"><span class="comment">//END of declaring your variables</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* GLOBALS_H_ */</span><span class="preprocessor"></span></div>
</div><!-- fragment --> <h2><a class="anchor" id="autotoc_md10"></a>
The global variables you declared in &lt;tt&gt;globals.h&lt;/tt&gt; must be also defined (assigned default values) into a &lt;tt&gt;globals.c&lt;/tt&gt; file following these steps:</h2>
<ul>
<li>navigate to "Project Explorer / YourProject / Core / Src";</li>
<li>right-click on "Src" folder;</li>
<li>choose "New / Source file";</li>
<li>in the "New Source File" dialog window write "globals.c" in the "Source file:" field and choose "Default C header template" in "Template" field. Click "Finish".</li>
<li><code>globals.c</code> file opens automatically. Add the '#include "global_variables.h"' line and set the type and the default value of each of your global variables.</li>
</ul>
<p>Example of how the content of <code>globals.c</code> content should look like: </p><div class="fragment"><div class="line"><span class="comment">/* === globals.c === */</span></div>
<div class="line"><span class="preprocessor">#include &quot;global_variables.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">//START of declaring your variables</span></div>
<div class="line"><span class="keywordtype">int</span> globalVariableName1 = 0;  <span class="comment">// Definition of the 1st variable</span></div>
<div class="line"><span class="keywordtype">int</span> globalVariableName2 = 0;  <span class="comment">// Definition of the 2nd variable</span></div>
<div class="line"><span class="keywordtype">int</span> globalVariableName3 = 0;  <span class="comment">// Definition of the 3rd variable</span></div>
<div class="line"><span class="comment">//START of declaring your variables</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md11"></a>
To make your global variables available to the main code, the &lt;tt&gt;globals.h&lt;/tt&gt; file must be included into &lt;tt&gt;main.c&lt;/tt&gt; file following these steps:</h2>
<ul>
<li>navigate to "Project Explorer / YourProject / Core / Src" and open the <code><a class="el" href="main_8c.html" title=": Main program body">main.c</a></code> file;</li>
<li>search for the &lsquo;'Private includes&rsquo;<code>section and include your</code>globals.h` file as shown in the example below. <div class="fragment"><div class="line"><span class="comment">/* === main.c === */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Private includes ----------------------------------------------------------*/</span></div>
<div class="line"><span class="comment">/* USER CODE BEGIN Includes */</span></div>
<div class="line"><span class="preprocessor">#include &quot;globals.h&quot;</span></div>
<div class="line"><span class="comment">/* USER CODE END Includes */</span></div>
</div><!-- fragment --></li>
</ul>
<h2><a class="anchor" id="autotoc_md12"></a>
To make your global variables available to other source code files, the &lt;tt&gt;globals.h&lt;/tt&gt; file must be included into that souce code file following these steps:</h2>
<div class="fragment"><div class="line"><span class="comment">/* === OtherThanGlobals.c === */</span></div>
<div class="line"><span class="preprocessor">#include &quot;globals.h&quot;</span></div>
<div class="line"><span class="keywordtype">int</span> localVariableName = globalVariableName;</div>
</div><!-- fragment --><blockquote class="doxtable">
<p>&zwj;⚠️ A global variable must always be defines only once, in the <code>globals.c</code> file. Otherwise you will get a compilation error. </p>
</blockquote>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
