# 13.Receive serial data

## Description
This module documents how to setup serial communication on your STM32 board so you can receive commands in the `<command_id;command_argument>` format

## Installation
Simply copy `Core/Inc/command_parser.h` and `Core/Src/command_parser.c` to your project's `Core/Inc` and `Core/Src` folders respectively.

## Configuring
In order for the `command_parser` library to work, you need to configure a USART peripheral in CubeMX. If you have a VCP (Virtual COM Port) connected to a peripheral, use that. If not, any will do.

### In CubeMX:
USARTx:
    - Mode: Asynchronous
    - Configuration tab:
        - **Parameter Settings**: Leave everything default. Change **Baud Rate**, **Parity** and **Stop Bits** if you want.
        - **NVIC Settings**: Enable USARTx global interrupt.

### In code:
Put all these snippets in `main.c`. Replace `huart1` with your uart handle.
0. Define the RX buffer size:
```c
/* USER CODE BEGIN PD */
#define RX_BUFFER_SIZE 32
/* USER CODE END PD */
```

1. Create an RX buffer:
```c
/* USER CODE BEGIN 0 */
uint8_t rx_buff[RX_BUFFER_SIZE];
/* USER CODE END 0 */
```

2. Start reception:
```c
/* USER CODE BEGIN 2 */
HAL_UART_Receive_IT(&huart1, rx_buff, RX_BUFFER_SIZE);
/* USER CODE END 2 */
```

3. Define a reception completed callback. This function will be called on every byte received.
```c
/* USER CODE BEGIN 4 */
void HAL_UART_RxCpltCallback(UART_HandleTypeDef *huart)
{
  // This will fill the buffer with the received bytes in a circular manner
  HAL_UART_Receive_IT(&huart1, rx_buff, RX_BUFFER_SIZE);
}
/* USER CODE END 4 */
```