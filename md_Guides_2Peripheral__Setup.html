<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>STM Code Blocks: Peripheral Setup Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">STM Code Blocks
   </div>
   <div id="projectbrief">Easy to use and understand code blocks for the STM MCU family</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_Guides_2Peripheral__Setup.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Peripheral Setup Guide</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md7"></a> This guide explains how to configure basic I/O and peripheral functionality on STM32 microcontrollers using STM32CubeIDE.</p>
<h1><a class="anchor" id="autotoc_md8"></a>
Digital Input / Output</h1>
<ol type="1">
<li>Open your <code>.ioc</code> file in STM32CubeIDE.</li>
<li>In the <b>Pinout &amp; Configuration</b> tab, click on a GPIO pin.</li>
<li>Set it as:<ul>
<li><b>GPIO_Output</b> for output (e.g., driving an LED)</li>
<li><b>GPIO_Input</b> for input (e.g., reading a button)</li>
</ul>
</li>
<li>Go to <b>Configuration &gt; GPIO</b> to verify settings like pull-up/pull-down.</li>
<li>In code, use HAL functions: <div class="fragment"><div class="line"><span class="comment">// Output</span></div>
<div class="line">HAL_GPIO_WritePin(GPIOA, GPIO_PIN_5, GPIO_PIN_SET);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Input</span></div>
<div class="line">GPIO_PinState state = HAL_GPIO_ReadPin(GPIOC, GPIO_PIN_13);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// If you set a label on the pin earlier, for example BLUE_LED, you can write this:</span></div>
<div class="line">HAL_GPIO_WritePin(BLUE_LED_GPIO_Port, BLUE_LED_Pin, GPIO_PIN_SET);</div>
<div class="line"><span class="comment">// These definitions are stored in main.h</span></div>
</div><!-- fragment --></li>
</ol>
<h1><a class="anchor" id="autotoc_md9"></a>
Analog Input</h1>
<ol type="1">
<li>Enable <b>ADC peripheral</b> under <b>Analog</b>.</li>
<li>Pick the <b>Channel</b> you want. Note that you cannot reassign the pins of the Channels.</li>
<li>Configure ADC settings (resolution, alignment, etc.)</li>
<li>Generate code.</li>
<li>In your code:</li>
</ol>
<p>a. For a single channel: </p><div class="fragment"><div class="line">uint32_t adc_val = 0; </div>
<div class="line">HAL_ADC_Start(&amp;hadc1);  <span class="comment">// This line needs to be before the while loop</span></div>
<div class="line">HAL_ADC_PollForConversion(&amp;hadc1, HAL_MAX_DELAY); <span class="comment">// Wait for conversion to be completed</span></div>
<div class="line">adc_val = HAL_ADC_GetValue(&amp;hadc1);</div>
<div class="line">HAL_ADC_Stop(&amp;hadc1); <span class="comment">// Stop conversion</span></div>
</div><!-- fragment --><p> b. For multiple channels:</p>
<p>First, make sure <b>Number of Conversion</b> in <b>Configuration &gt; Parameter Settings &gt; ADC_Regular_ConversionMode</b> matches the number of channels you want to convert. Then, for each <b>Rank</b>, assign a Channel.</p>
<p>For example, if Rank 1 is Channel 1 and Rank 2 is Channel 2: </p><div class="fragment"><div class="line">uint32_t adc_val_channel1 = 0;</div>
<div class="line">uint32_t adc_val_channel2 = 0;</div>
<div class="line">HAL_ADC_Start(&amp;hadc1);</div>
<div class="line"><span class="comment">// Once polling starts, you don&#39;t need to call PollForConversion if you set the ADC to run in Continuous mode. If it is in Single mode, then you need to PollForConversion every time you need new values.</span></div>
<div class="line">HAL_ADC_PollForConversion(&amp;hadc1, HAL_MAX_DELAY);</div>
<div class="line">adc_val_channel1 = HAL_ADC_GetValue(&amp;hadc1);</div>
<div class="line">adc_val_channel2 = HAL_ADC_GetValue(&amp;hadc1);</div>
<div class="line">HAL_ADC_Stop(&amp;hadc1);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md10"></a>
PWM Output</h1>
<p>To generate <b>PWM signals</b>, we need to use <b>Timers</b>. Pick a timer and configure it:</p><ul>
<li>Clock Source: Choose your clock source. If you don't know what to pick, choose Internal Clock.</li>
<li>Channel<code>x</code>: <b>PWM Generation <code>CHx</code></b>. <code>CHxN</code> means the same output as <code>CHx</code> but inversed. You can both <code>CHx</code> and <code>CHxN</code> to generate synchronised, opposite PWM signals by simply choosing <b>PWM Generation CHx CHxN</b>.</li>
<li>Under <b>Configuration &gt; Parameter Settings</b> use <a href="https://deepbluembedded.com/stm32-pwm-calculator/">this site</a> to get the values you need. <b>Make sure to enable auto-reload preload!</b><ul>
<li>For <b>clock frequency</b>, you need to see which <code>APBx</code> your timer uses. This can be found in your MCU's data sheet, in the <b>Block Diagram</b>.</li>
</ul>
</li>
</ul>
<p>To change the PWM's duty cycle programatically: </p><div class="fragment"><div class="line">TIMx-&gt;CCRy = duty_cycle;</div>
</div><!-- fragment --><p> Where <code>x</code> is your Timer's number and <code>y</code> is the number of the Channel whose Duty Cycle you want to update.</p>
<h1><a class="anchor" id="autotoc_md11"></a>
Triggering an interrupt on an arbitrary pin</h1>
<ul>
<li>Pick the pin you want to generate interrupts on. Note that not all pins have the ability to generate external interrupts.</li>
<li>Configure the pin as <code>GPIO_EXTIx</code></li>
<li>Under <b>GPIO &gt; Configuration &gt; Pxx</b> you can configure your interrupt to generate on falling, rising, or both edges. Choose <b>No pull-up and no pull-down</b>.</li>
<li>Under <b>NVIC &gt; Configuration</b> make sure <b>EXTI line interrupts</b> is enabled.</li>
<li>Generate the code.</li>
</ul>
<p>In your <code><a class="el" href="main_8c.html" title=": Main program body">main.c</a></code> you need to add the <b>ISR</b> (Interrupt Service Routine): </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> HAL_GPIO_EXTI_Callback(uint16_t GPIO_Pin)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span>(GPIO_Pin == GPIO_PIN_9) <span class="comment">// If The INT Source Is EXTI Line9 we set up earlier</span></div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Do whatever you need to do</span></div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md12"></a>
UART Communication</h1>
<p><a href="https://wiki.st.com/stm32mcu/wiki/Getting_started_with_UART">https://wiki.st.com/stm32mcu/wiki/Getting_started_with_UART</a></p>
<blockquote class="doxtable">
<p>&zwj;ℹ️ Some boards (Like the F411E Discovery) do not support VCP (Virtual COM Port), meaning you cannot use the ST-Link USB port as a serial communication port. If that is the case, you need to use the RX/TX pins themselves and use a USB to Serial converter to talk to the PC. </p>
</blockquote>
<blockquote class="doxtable">
<p>&zwj;⚠️ Setting baud rate too high may result in lost bytes when receiving data in bulk without DMA </p>
</blockquote>
<h1><a class="anchor" id="autotoc_md13"></a>
SPI Communication</h1>
<p><a href="https://wiki.st.com/stm32mcu/wiki/Getting_started_with_SPI">https://wiki.st.com/stm32mcu/wiki/Getting_started_with_SPI</a></p>
<h1><a class="anchor" id="autotoc_md14"></a>
I2C Communication</h1>
<p><a href="https://wiki.st.com/stm32mcu/wiki/Getting_started_with_I2C">https://wiki.st.com/stm32mcu/wiki/Getting_started_with_I2C</a></p>
<h1><a class="anchor" id="autotoc_md15"></a>
Setting a timer interrupt</h1>
<p><a href="https://wiki.st.com/stm32mcu/wiki/Getting_started_with_TIM#TIM_with_interrupt">https://wiki.st.com/stm32mcu/wiki/Getting_started_with_TIM#TIM_with_interrupt</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
